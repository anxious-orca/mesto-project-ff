(()=>{"use strict";var t=function(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",o)},e=function(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o)},n=function(t){t.classList.add("popup_is-animated"),t.querySelector(".popup__close").addEventListener("click",(function(){return e(t)})),t.addEventListener("click",(function(n){n.target.classList.contains("popup")&&e(t)}))},o=function(t){if("Escape"===t.key){var n=document.querySelector(".popup_is-opened");e(n)}};function c(t,e){e?(t.textContent="Сохранение...",t.classList.add("popup__button_text-animated")):(t.textContent="Сохранить",t.classList.remove("popup__button_text-animated"))}var r={baseUrl:"https://nomoreparties.co/v1",cohortId:"/wff-cohort-33",headers:{authorization:"3f9599d2-cf13-400f-8219-d966b8c8a4cc","Content-Type":"application/json"}},a=function(){return fetch("".concat(r.baseUrl).concat(r.cohortId,"/users/me"),{headers:r.headers}).then((function(t){return t.ok?t.json():Promise.reject(t.status)}))},i=function(t){var e=t.cardData,n=t.openPopupDeleteFunction,o=t.likeCardFunction,c=t.openCardFunction,r=t.userId,a=t.isLikedFunction,i=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),u=i.querySelector(".card__title"),s=i.querySelector(".card__image"),l=i.querySelector(".card__delete-button"),d=i.querySelector(".card__like-button"),p=i.querySelector(".like-count"),f=e._id;return i.id="id".concat(f),u.textContent=e.name,s.src=e.link,s.alt="Изображение места: ".concat(e.name),p.textContent=e.likes.length,e.owner._id===r?l.addEventListener("click",(function(){return n(f)})):l.remove(),a(e,d,r),d.addEventListener("click",(function(){return o(f,d,p)})),s.addEventListener("click",(function(){return c(s.src,u.textContent)})),i},u=function(t,e,n){(function(t,e){return t.likes.some((function(t){return t._id===e}))})(t,n)&&e.classList.add("card__like-button_is-active")},s=function(t,e,n){e.classList.contains("card__like-button_is-active")?(function(t,e){var n;(n=t,fetch("".concat(r.baseUrl).concat(r.cohortId,"/cards/likes/").concat(n),{method:"DELETE",headers:r.headers}).then((function(t){return t.ok?t.json():Promise.reject(t.status)}))).then((function(t){e.textContent=t.likes.length})).catch((function(t){console.log("Ошибка: ".concat(t))}))}(t,n),e.classList.remove("card__like-button_is-active")):(function(t,e){var n;(n=t,fetch("".concat(r.baseUrl).concat(r.cohortId,"/cards/likes/").concat(n),{method:"PUT",headers:r.headers}).then((function(t){return t.ok?t.json():Promise.reject(t.status)}))).then((function(t){e.textContent=t.likes.length})).catch((function(t){console.log("Ошибка: ".concat(t))}))}(t,n),e.classList.add("card__like-button_is-active"))},l=function(t,e,n){t.classList.remove(n.inputErrorClass),e.classList.remove(n.errorClass),e.textContent=""},d=function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(n.inactiveButtonClass)):(e.disabled=!0,e.classList.add(n.inactiveButtonClass))},p=function(t,e){var n=t.querySelector(e.submitButtonSelector);t.querySelectorAll(e.inputSelector).forEach((function(n){var o=t.querySelector(".".concat(n.id,"-error"));l(n,o,e)})),n.disabled=!0,n.classList.add(e.inactiveButtonClass)},f=document.querySelector(".content"),m=f.querySelector(".places__list"),_=document.querySelector(".popup_type_image"),v=_.querySelector(".popup__image"),h=_.querySelector(".popup__caption"),y=document.querySelector(".popup_type_edit"),S=f.querySelector(".profile__edit-button"),b=document.forms.editProfile,C=y.querySelector(".popup__button_text"),k=b.name,L=b.description,q=f.querySelector(".profile__title"),x=f.querySelector(".profile__description"),E=document.querySelector(".popup_type_edit-avatar"),g=f.querySelector(".avatar__edit-button"),P=document.forms.editAvatar,T=E.querySelector(".popup__button_text"),j=P.avatarLink,D=f.querySelector(".profile__image"),I=document.querySelector(".popup_type_new-card"),F=f.querySelector(".profile__add-button"),U=document.forms.newPlace,A=I.querySelector(".popup__button_text"),N=U.placeName,w=U.link,B=document.querySelector(".popup_type_delete"),J=B.querySelector(".popup__button-delete"),O=B.querySelector("#cardId"),M={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},H=function(e,n){v.src=e,v.alt="Изображение места: ".concat(n),h.textContent=n,t(_)},V=function(e){O.textContent=e,t(B)};n(_),n(y),n(E),n(I),n(B),S.addEventListener("click",(function(){return n=(e={popup:y,form:b,titleContainer:q,descripitionContainer:x,customTitle:k,customDescripition:L}).popup,o=e.form,c=e.titleContainer,r=e.descripitionContainer,a=e.customDescripition,e.customTitle.value=c.textContent,a.value=r.textContent,p(o,M),void t(n);var e,n,o,c,r,a})),b.addEventListener("submit",(function(t){return function(t,n){var o,a,i=n.popup,u=n.titleContainer,s=n.descripitionContainer,l=n.customTitle,d=n.customDescripition,p=n.buttonText;t.preventDefault(),c(p,!0),(o=l.value,a=d.value,fetch("".concat(r.baseUrl).concat(r.cohortId,"/users/me"),{method:"PATCH",headers:r.headers,body:JSON.stringify({name:o,about:a,avatar:"https://i.imgur.com/JSFINoW.jpeg"})}).then((function(t){return t.ok?t.json():Promise.reject(t.status)}))).then((function(t){u.textContent=t.name,s.textContent=t.about,e(i)})).catch((function(t){console.log("Ошибка: ".concat(t))})).finally((function(){c(p,!1)}))}(t,{popup:y,titleContainer:q,descripitionContainer:x,customTitle:k,customDescripition:L,buttonText:C})})),g.addEventListener("click",(function(){return e=E,p(P,M),void t(e);var e})),P.addEventListener("submit",(function(t){return function(t,n){var o,a=n.form,i=n.popup,u=n.avatarContainer,s=n.avatarLink,l=n.buttonText;t.preventDefault(),c(l,!0),(o=s.value,fetch("".concat(r.baseUrl).concat(r.cohortId,"/users/me/avatar"),{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:o})}).then((function(t){return t.ok?t.json():Promise.reject(t.status)}))).then((function(t){u.src=t.avatar,u.alt="Аватарка пользователя: ".concat(t.name),e(i)})).catch((function(t){console.log("Ошибка: ".concat(t))})).finally((function(){c(l,!1),a.reset()}))}(t,{form:P,popup:E,avatarContainer:D,avatarLink:j,buttonText:T})})),F.addEventListener("click",(function(){return e=I,p(U,M),void t(e);var e})),U.addEventListener("submit",(function(t){return function(t,n){var o=n.form,a=n.popup,l=n.cardName,d=n.cardLink,p=n.cardList,f=n.buttonText;t.preventDefault(),c(f,!0),function(t,e){return fetch("".concat(r.baseUrl).concat(r.cohortId,"/cards"),{method:"POST",headers:r.headers,body:JSON.stringify({name:t,link:e})}).then((function(t){return t.ok?t.json():Promise.reject(t.status)}))}(l.value,d.value).then((function(t){var n=i({cardData:t,openPopupDeleteFunction:V,likeCardFunction:s,openCardFunction:H,isLikedFunction:u,userId:t.owner._id});p.prepend(n),e(a)})).catch((function(t){console.log("Ошибка: ".concat(t))})).finally((function(){c(f,!1),o.reset()}))}(t,{form:U,popup:I,cardName:N,cardLink:w,cardList:m,buttonText:A})})),J.addEventListener("click",(function(){var t=O.textContent,n=f.querySelector("#id".concat(t));!function(t,n,o){var c;(c=o,fetch("".concat(r.baseUrl).concat(r.cohortId,"/cards/").concat(c),{method:"DELETE",headers:r.headers}).catch((function(t){console.log(t)}))).then((function(){n.remove(),e(t)})).catch((function(t){console.log("Ошибка: ".concat(t))}))}(B,n,t)})),Promise.all([fetch("".concat(r.baseUrl).concat(r.cohortId,"/cards"),{headers:r.headers}).then((function(t){return t.ok?t.json():Promise.reject(t.status)})),a()]).then((function(t){t[0].forEach((function(e){var n=i({cardData:e,openPopupDeleteFunction:V,likeCardFunction:s,openCardFunction:H,isLikedFunction:u,userId:t[1]._id});m.append(n)}))})).catch((function(t){console.log("Ошибка: ".concat(t))})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){!function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);d(n,o,e),n.forEach((function(c){var r=t.querySelector(".".concat(c.id,"-error"));c.addEventListener("input",(function(){!function(t,e,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?l(t,e,n):function(t,e,n,o){t.classList.add(o.inputErrorClass),e.textContent=n,e.classList.add(o.errorClass)}(t,e,t.validationMessage,n)}(c,r,e),d(n,o,e)}))}))}(e,t)}))}(M),a().then((function(t){q.textContent=t.name,x.textContent=t.about,D.src=t.avatar})).catch((function(t){console.log("Ошибка: ".concat(t))}))})();