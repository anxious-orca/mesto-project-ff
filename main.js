(()=>{"use strict";var t,e,n=function(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",r)},o=function(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",r)},c=function(t){t.classList.add("popup_is-animated"),t.querySelector(".popup__close").addEventListener("click",(function(){return o(t)})),t.addEventListener("click",(function(e){e.target.classList.contains("popup")&&o(t)}))},r=function(t){if("Escape"===t.key){var e=document.querySelector(".popup_is-opened");o(e)}},a=function(t){var e=t.cardData,n=t.openPopupDeleteFunction,o=t.likeCardFunction,c=t.openCardFunction,r=t.userId,a=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),i=a.querySelector(".card__title"),u=a.querySelector(".card__image"),s=a.querySelector(".card__delete-button"),l=a.querySelector(".card__like-button"),d=a.querySelector(".like-count"),p=e._id;return i.textContent=e.name,u.src=e.link,u.alt="Изображение места: ".concat(e.name),d.textContent=e.likes.length,e.owner._id===r?s.addEventListener("click",(function(){return n(a,p)})):s.remove(),e.likes.some((function(t){return t._id===r}))&&l.classList.add("card__like-button_is-active"),l.addEventListener("click",(function(){return o(p,l,d)})),u.addEventListener("click",(function(){return c(u.src,i.textContent)})),a},i=function(t,e,n){t.classList.remove(n.inputErrorClass),e.classList.remove(n.errorClass),e.textContent=""},u=function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(n.inactiveButtonClass)):(e.disabled=!0,e.classList.add(n.inactiveButtonClass))},s=function(t,e){var n=t.querySelector(e.submitButtonSelector);t.querySelectorAll(e.inputSelector).forEach((function(n){var o=t.querySelector(".".concat(n.id,"-error"));i(n,o,e)})),n.disabled=!0,n.classList.add(e.inactiveButtonClass)},l={baseUrl:"https://nomoreparties.co/v1",cohortId:"/wff-cohort-33",headers:{authorization:"3f9599d2-cf13-400f-8219-d966b8c8a4cc","Content-Type":"application/json"}},d=function(t){return t.ok?t.json():Promise.reject(t.status)},p=document.querySelector(".content"),f=p.querySelector(".places__list"),_=document.querySelector(".popup_type_image"),m=_.querySelector(".popup__image"),h=_.querySelector(".popup__caption"),v=document.querySelector(".popup_type_edit"),y=p.querySelector(".profile__edit-button"),S=document.forms.editProfile,b=v.querySelector(".popup__button_text"),C=S.name,q=S.description,L=p.querySelector(".profile__title"),k=p.querySelector(".profile__description"),E=document.querySelector(".popup_type_edit-avatar"),g=p.querySelector(".avatar__edit-button"),x=document.forms.editAvatar,I=E.querySelector(".popup__button_text"),D=x.avatarLink,P=p.querySelector(".profile__image"),F=document.querySelector(".popup_type_new-card"),U=p.querySelector(".profile__add-button"),A=document.forms.newPlace,w=F.querySelector(".popup__button_text"),B=A.placeName,T=A.link,N=document.querySelector(".popup_type_delete"),j=N.querySelector(".popup__button-delete"),J={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},O=function(t,e){m.src=t,m.alt="Изображение места: ".concat(e),h.textContent=e,n(_)};function M(t,e){e?(t.textContent="Сохранение...",t.classList.add("popup__button_text-animated")):(t.textContent="Сохранить",t.classList.remove("popup__button_text-animated"))}var H=function(o,c){t=c,e=o,n(N)},V=function(t,e,n){var o=function(t){return t.classList.contains("card__like-button_is-active")}(e)?function(t){return fetch("".concat(l.baseUrl).concat(l.cohortId,"/cards/likes/").concat(t),{method:"DELETE",headers:l.headers}).then((function(t){return d(t)}))}(t):function(t){return fetch("".concat(l.baseUrl).concat(l.cohortId,"/cards/likes/").concat(t),{method:"PUT",headers:l.headers}).then((function(t){return d(t)}))}(t);o.then((function(t){!function(t,e,n){e.classList.toggle("card__like-button_is-active"),n.textContent=t.likes.length}(t,e,n)})).catch((function(t){console.log("Ошибка: ".concat(t))}))};c(_),c(v),c(E),c(F),c(N),y.addEventListener("click",(function(){C.value=L.textContent,q.value=k.textContent,s(S,J),n(v)})),S.addEventListener("submit",(function(t){var e,n;t.preventDefault(),M(b,!0),(e=C.value,n=q.value,fetch("".concat(l.baseUrl).concat(l.cohortId,"/users/me"),{method:"PATCH",headers:l.headers,body:JSON.stringify({name:e,about:n,avatar:"https://i.imgur.com/JSFINoW.jpeg"})}).then((function(t){return d(t)}))).then((function(t){L.textContent=t.name,k.textContent=t.about,o(v)})).catch((function(t){console.log("Ошибка: ".concat(t))})).finally((function(){M(b,!1)}))})),g.addEventListener("click",(function(){s(x,J),n(E)})),x.addEventListener("submit",(function(t){var e;t.preventDefault(),M(I,!0),(e=D.value,fetch("".concat(l.baseUrl).concat(l.cohortId,"/users/me/avatar"),{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:e})}).then((function(t){return d(t)}))).then((function(t){P.src=t.avatar,P.alt="Аватарка пользователя: ".concat(t.name),o(E),x.reset()})).catch((function(t){console.log("Ошибка: ".concat(t))})).finally((function(){M(I,!1)}))})),U.addEventListener("click",(function(){s(A,J),n(F)})),A.addEventListener("submit",(function(t){var e,n;t.preventDefault(),M(w,!0),(e=B.value,n=T.value,fetch("".concat(l.baseUrl).concat(l.cohortId,"/cards"),{method:"POST",headers:l.headers,body:JSON.stringify({name:e,link:n})}).then((function(t){return d(t)}))).then((function(t){var e=a({cardData:t,openPopupDeleteFunction:H,likeCardFunction:V,openCardFunction:O,userId:t.owner._id});f.prepend(e),o(F),A.reset()})).catch((function(t){console.log("Ошибка: ".concat(t))})).finally((function(){M(w,!1)}))})),j.addEventListener("click",(function(){(function(t){return fetch("".concat(l.baseUrl).concat(l.cohortId,"/cards/").concat(t),{method:"DELETE",headers:l.headers}).catch((function(t){console.log(t)}))})(t).then((function(){e.remove(),o(N)})).catch((function(t){console.log("Ошибка: ".concat(t))}))})),Promise.all([fetch("".concat(l.baseUrl).concat(l.cohortId,"/cards"),{headers:l.headers}).then((function(t){return d(t)})),fetch("".concat(l.baseUrl).concat(l.cohortId,"/users/me"),{headers:l.headers}).then((function(t){return d(t)}))]).then((function(t){L.textContent=t[1].name,k.textContent=t[1].about,P.src=t[1].avatar,t[0].forEach((function(e){var n=a({cardData:e,openPopupDeleteFunction:H,likeCardFunction:V,openCardFunction:O,userId:t[1]._id});f.append(n)}))})).catch((function(t){console.log("Ошибка: ".concat(t))})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){!function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);u(n,o,e),n.forEach((function(c){var r=t.querySelector(".".concat(c.id,"-error"));c.addEventListener("input",(function(){!function(t,e,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?i(t,e,n):function(t,e,n,o){t.classList.add(o.inputErrorClass),e.textContent=n,e.classList.add(o.errorClass)}(t,e,t.validationMessage,n)}(c,r,e),u(n,o,e)}))}))}(e,t)}))}(J)})();